<!doctype html>
<html lang="en"> 
 <head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>Advance Calculator</title> 
  <script src="https://cdn.tailwindcss.com"></script> 
  <link rel="preconnect" href="https://fonts.googleapis.com"> 
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&amp;display=swap" rel="stylesheet"> 
  <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f7f7f7;
        }
        .calculator-container {
            position: relative;
            width: 100%;
            max-width: 390px;
            height: 100vh;
            max-height: 844px; /* iPhone 14 Pro dimensions */
            margin: auto;
            overflow: hidden; /* This is key for the sliding panel */
        }
        .calculator-body {
            background-color: #ffffff;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border-radius: 32px;
            z-index: 10;
        }
        .display-area {
            position: relative;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 1rem 2rem 0.5rem;
        }
        #history-toggle {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            color: #5f6368;
            padding: 0.5rem;
        }
        #display {
            background: transparent;
            border: none;
            outline: none;
            color: #1f1f1f;
            text-align: right;
            width: 100%;
            font-size: 3.5rem;
            font-weight: 400;
            line-height: 1.2;
            min-height: 60px;
        }
        .buttons-grid {
            padding: 1.5rem;
            background-color: #f1f3f4;
            border-top-left-radius: 24px;
            border-top-right-radius: 24px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
        }
        .btn {
            display: flex; align-items: center; justify-content: center;
            border-radius: 9999px;
            font-size: 1.5rem;
            font-weight: 500;
            transition: background-color 0.2s ease, transform 0.1s ease;
            aspect-ratio: 1 / 1;
            user-select: none;
        }
        .btn:focus { outline: none; }
        .btn:active { transform: scale(0.95); }
        .btn-number { background-color: #e8eaed; color: #202124; }
        .btn-number:hover { background-color: #dfe1e5; }
        .btn-top-op { background-color: #d0e3ff; color: #0b57d0; }
        .btn-top-op:hover { background-color: #b9d5ff; }
        .btn-side-op { background-color: #a4c2f4; color: #0b57d0; font-size: 1.75rem; }
        .btn-side-op:hover { background-color: #8cb2f2; }
        .btn-equals { background-color: #0b57d0; color: #ffffff; }
        .btn-equals:hover { background-color: #0a50be; }
        
        /* History Panel */
        #history-panel {
            position: absolute;
            top: 0;
            right: 0;
            width: 85%;
            height: 100%;
            background-color: #e8eaed;
            z-index: 20;
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
            border-radius: 32px 0 0 32px;
            box-shadow: -5px 0 25px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }
        #history-panel.active {
            transform: translateX(0);
        }
        #history-content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
        }
        .history-item {
            padding: 0.75rem 1rem;
            border-radius: 12px;
            cursor: pointer;
            text-align: right;
        }
        .history-item:hover {
            background-color: #dfe1e5;
        }
        .history-item .expression {
            color: #5f6368;
            font-size: 1rem;
            display: block;
        }
        .history-item .result {
            color: #202124;
            font-size: 1.5rem;
            font-weight: 500;
            display: block;
        }
        
        /* Adaptive font size */
        .font-size-large { font-size: 3.5rem; }
        .font-size-medium { font-size: 2.75rem; }
        .font-size-small { font-size: 2rem; }
    </style> 
 </head> 
 <body class="flex items-center justify-center min-h-screen"> 
  <div class="calculator-container"> 
   <div class="calculator-body"> <!-- Display Screen --> 
    <div class="display-area"> <button id="history-toggle" onclick="toggleHistory()"> 
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="currentColor"> <path d="M13 3a9 9 0 0 0-9 9H1l3.89 3.89.07.14L9 12H6a7 7 0 0 1 7-7 7 7 0 0 1 7 7 7 7 0 0 1-7 7v2a9 9 0 0 0 9-9 9 9 0 0 0-9-9zm-1 5v5l4.25 2.52.75-1.23-3.5-2.07V8H12z" /> 
      </svg> </button> 
     <input id="display" type="text" readonly class="font-size-large"> 
    </div> <!-- Calculator Buttons --> 
    <div class="buttons-grid"> <button onclick="clearDisplay()" class="btn btn-top-op">AC</button> <button onclick="deleteLast()" class="btn btn-top-op">DEL</button> <button onclick="appendToDisplay('%')" class="btn btn-top-op">%</button> <button onclick="appendToDisplay('/')" class="btn btn-side-op">÷</button> <button onclick="appendToDisplay('*2')" class="btn btn-top-op">x²</button> <button onclick="appendToDisplay('Math.sqrt(')" class="btn btn-top-op">√</button> <button onclick="appendToDisplay('(')" class="btn btn-top-op">(</button> <button onclick="appendToDisplay(')')" class="btn btn-top-op">)</button> <button onclick="appendToDisplay('7')" class="btn btn-number">7</button> <button onclick="appendToDisplay('8')" class="btn btn-number">8</button> <button onclick="appendToDisplay('9')" class="btn btn-number">9</button> <button onclick="appendToDisplay('')" class="btn btn-side-op">×</button> <button onclick="appendToDisplay('4')" class="btn btn-number">4</button> <button onclick="appendToDisplay('5')" class="btn btn-number">5</button> <button onclick="appendToDisplay('6')" class="btn btn-number">6</button> <button onclick="appendToDisplay('-')" class="btn btn-side-op">−</button> <button onclick="appendToDisplay('1')" class="btn btn-number">1</button> <button onclick="appendToDisplay('2')" class="btn btn-number">2</button> <button onclick="appendToDisplay('3')" class="btn btn-number">3</button> <button onclick="appendToDisplay('+')" class="btn btn-side-op">+</button> <button onclick="appendToDisplay('0')" class="btn btn-number col-span-2 w-auto aspect-auto rounded-full">0</button> <button onclick="appendToDisplay('.')" class="btn btn-number">.</button> <button onclick="calculateResult()" class="btn btn-equals">=</button> 
    </div> 
   </div> <!-- History Panel --> 
   <div id="history-panel"> 
    <div class="flex justify-between items-center p-4 border-b border-gray-300"> 
     <div class="flex items-center gap-2"> <!-- NEW: Back button --> <button onclick="toggleHistory()" class="p-2 rounded-full hover:bg-gray-300 transition-colors"> 
       <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="currentColor" class="text-gray-600"> <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" /> 
       </svg> </button> 
      <h2 class="text-xl font-medium text-gray-700">History</h2> 
     </div> <button onclick="clearHistory()" class="text-sm text-blue-600 hover:text-blue-800 font-medium">Clear</button> 
    </div> 
    <div id="history-content"> <!-- History items will be injected here --> 
    </div> 
   </div> 
  </div> 
  <script>
        const display = document.getElementById('display');
        const historyPanel = document.getElementById('history-panel');
        const historyContent = document.getElementById('history-content');
        let calculationHistory = [];

        function adjustFontSize() {
            const len = display.value.length;
            display.classList.remove('font-size-large', 'font-size-medium', 'font-size-small');
            if (len > 16) {
                display.classList.add('font-size-small');
            } else if (len > 11) {
                display.classList.add('font-size-medium');
            } else {
                display.classList.add('font-size-large');
            }
        }

        function appendToDisplay(value) {
            if (display.value === 'Error' || display.value === 'Infinity') {
                clearDisplay();
            }
            // If √ is pressed, show it visually but use Math.sqrt internally
            if (value === 'Math.sqrt(') {
                display.value += '√(';
            } else {
                display.value += value;
            }
            adjustFontSize();
        }

        function clearDisplay() {
            display.value = '';
            adjustFontSize();
        }

        function deleteLast() {
            // Handle deleting '√(' as a single unit
            if (display.value.endsWith('√(')) {
                display.value = display.value.slice(0, -2);
            } else {
                display.value = display.value.slice(0, -1);
            }
            adjustFontSize();
        }

        function calculateResult() {
            if (display.value === '' || display.value === 'Error') return;
            try {
                let visualExpression = display.value;
                let expression = visualExpression
                    .replace(/√/g, 'Math.sqrt')
                    .replace(/%/g, '/100');

                const result = new Function('return ' + expression)();
                
                if (isNaN(result) || !isFinite(result)) {
                    throw new Error("Invalid calculation");
                }
                
                const finalResult = String(parseFloat(result.toPrecision(12)));
                addToHistory(visualExpression, finalResult);
                display.value = finalResult;

            } catch (error) {
                display.value = 'Error';
            }
            adjustFontSize();
        }

        function toggleHistory() {
            historyPanel.classList.toggle('active');
        }

        function addToHistory(expression, result) {
            calculationHistory.unshift({ expression, result });
            if (calculationHistory.length > 50) { // Keep history to a reasonable size
                calculationHistory.pop();
            }
            updateHistoryView();
        }

        function updateHistoryView() {
            historyContent.innerHTML = '';
            if (calculationHistory.length === 0) {
                historyContent.innerHTML = '<p class="text-center text-gray-500 mt-8">No history yet</p>';
                return;
            }
            calculationHistory.forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerHTML = `
                    <span class="expression">${item.expression}</span>
                    <span class="result">= ${item.result}</span>
                `;
                div.onclick = () => {
                    display.value = item.expression;
                    adjustFontSize();
                    toggleHistory();
                };
                historyContent.appendChild(div);
            });
        }
        
        function clearHistory() {
            calculationHistory = [];
            updateHistoryView();
        }

        document.addEventListener('keydown', (event) => {
            const key = event.key;
            if ((key >= '0' && key <= '9') || key === '.' || key === '(' || key === ')') {
                appendToDisplay(key);
            } else if (key === '+' || key === '-' || key === '*' || key === '/' || key === '%') {
                appendToDisplay(key);
            } else if (key === 'Enter' || key === '=') {
                event.preventDefault();
                calculateResult();
            } else if (key === 'Backspace') {
                deleteLast();
            } else if (key === 'Escape' || key.toLowerCase() === 'c') {
                clearDisplay();
            }
        });
        
        // Initial setup
        adjustFontSize();
        updateHistoryView();
    </script> 
 </body>
</html>